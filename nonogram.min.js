!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nonogram=e():t.nonogram=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=7)}([function(t,e,n){"use strict";e.a={greyVeryLight:"#ccc",grey:"#555",greyVeryDark:"#111",blue:"#0ebeff",green:"#47cf73",violet:"#ae63e4",yellow:"#fcd000",red:"#ff3c41"}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return t.length===e.length&&t.every(function(t,n){return t===e[n]})}var o=n(0),s=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function(){function t(){r(this,t),this.theme={filledColor:o.a.grey,unsetColor:o.a.greyVeryLight,correctColor:o.a.green,wrongColor:o.a.red,meshColor:o.a.yellow,isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5}}return a(t,[{key:"initCanvas",value:function(t){var e=this,n=t instanceof HTMLCanvasElement?t:document.getElementById(t);n instanceof HTMLCanvasElement||(n=document.createElement("canvas")),this.canvas=n,this.canvas.nonogram&&this.canvas.nonogram.listeners.forEach(function(t){var n=s(t,2),r=n[0],i=n[1];e.canvas.removeEventListener(r,i)}),this.canvas.nonogram=this,this.canvas.width=this.theme.width||this.canvas.clientWidth,this.canvas.height=this.canvas.width*(this.m+1)/(this.n+1),this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.initListeners(),this.listeners.forEach(function(t){var n=s(t,2),r=n[0],i=n[1];e.canvas.addEventListener(r,i)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}}},{key:"initListeners",value:function(){this.listeners=[]}},{key:"removeNonPositiveHints",value:function(){function t(t,e,n){n[e]=t.filter(function(t){return t>0})}this.hints.row.forEach(t),this.hints.column.forEach(t)}},{key:"getSingleLine",value:function(t,e){var n=[];if("row"===t)for(var r=0;r<this.n;r+=1)n[r]=this.grid[e][r];else if("column"===t)for(var i=0;i<this.m;i+=1)n[i]=this.grid[i][e];return n}},{key:"calculateHints",value:function(t,e){var n=[];return this.getSingleLine(t,e).reduce(function(t,e){if(1===e)n.push(t?n.pop()+1:1);else if(0!==e)throw new Error;return 1===e},!1),n}},{key:"isLineCorrect",value:function(t,e){try{return i(this.calculateHints(t,e),this.hints[t][e])}catch(t){return!1}}},{key:"getLocation",value:function(t,e){var n=this.canvas.getBoundingClientRect(),r=n.width,i=n.height,o=2*r/3,s=2*i/3,a=o/(this.n+1);return t<0||t>=r||e<0||e>=i?"outside":t>=0&&t<=o&&e>=0&&e<s?a/2<=t&&t<o-a/2&&a/2<=e&&e<s-a/2?"grid":"limbo":o<=t&&t<r&&s<=e&&e<i?"controller":"hints"}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printController()}},{key:"printGrid",value:function(){var t=this.ctx,e=this.canvas,n=e.width,r=e.height,i=2*n/3/(this.n+1);t.clearRect(-1,-1,2*n/3+1,2*r/3+1),this.theme.isMeshed&&!this.theme.isMeshOnTop&&this.printMesh(),t.save(),t.translate(i/2,i/2);for(var o=0;o<this.m;o+=1)for(var s=0;s<this.n;s+=1)t.save(),t.translate(i*s,i*o),this.printCell(this.grid[o][s]),t.restore();t.restore(),this.theme.isMeshed&&this.theme.isMeshOnTop&&this.printMesh()}},{key:"printCell",value:function(t){var e=this.ctx,n=2*this.canvas.width/3/(this.n+1);switch(t){case 2:e.fillStyle=this.theme.unsetColor,e.fillRect(.05*n,.05*n,.9*n,.9*n);break;case 1:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-n,.05*-n,1.1*n,1.1*n)}}},{key:"printMesh",value:function(){var t=this.ctx,e=2*this.canvas.width/3/(this.n+1);t.save(),t.translate(e/2,e/2),t.beginPath();for(var n=1;n<this.m;n+=1)this.theme.isBoldMeshOnly||(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e)),n%this.theme.boldMeshGap==0&&(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e),this.theme.isBoldMeshOnly||(t.moveTo(0,n*e-1),t.lineTo(this.n*e,n*e-1),t.moveTo(0,n*e+1),t.lineTo(this.n*e,n*e+1)));for(var r=1;r<this.n;r+=1)this.theme.isBoldMeshOnly||(t.moveTo(r*e,0),t.lineTo(r*e,this.m*e)),r%this.theme.boldMeshGap==0&&(t.moveTo(r*e,0),t.lineTo(r*e,this.m*e),this.theme.isBoldMeshOnly||(t.moveTo(r*e-1,0),t.lineTo(r*e-1,this.m*e),t.moveTo(r*e+1,0),t.lineTo(r*e+1,this.m*e)));t.lineWidth=1,t.strokeStyle=this.theme.meshColor,t.stroke(),t.restore()}},{key:"printHints",value:function(){var t=this.ctx,e=this.canvas,n=e.width,r=e.height,i=2*n/3/(this.n+1);t.clearRect(2*n/3-1,-1,3*n+1,2*r/3+1),t.clearRect(-1,2*r/3-1,2*n/3+1,r/3+1),t.save(),t.translate(i/2,i/2);for(var o=0;o<this.m;o+=1){for(var s=0;s<this.hints.row[o].length;s+=1)this.printSingleHint("row",o,s);0===this.hints.row[o].length&&this.printSingleHint("row",o,0)}for(var a=0;a<this.n;a+=1){for(var c=0;c<this.hints.column[a].length;c+=1)this.printSingleHint("column",a,c);0===this.hints.column[a].length&&this.printSingleHint("column",a,0)}t.restore()}},{key:"printSingleHint",value:function(t,e,n){var r=this.ctx,i=this.canvas,o=i.width,s=i.height,a=2*o/3/(this.n+1);r.textAlign="center",r.textBaseline="middle",r.font=a+'pt "Courier New", Inconsolata, Consolas, monospace';var c=this.hints[t][e];r.fillStyle=c.isCorrect?this.theme.correctColor:this.theme.wrongColor,r.globalAlpha=!c.isCorrect&&c.unchanged?.5:1,"row"===t?r.fillText(""+(this.hints.row[e][n]||0),2*o/3+a*n,a*(e+.5),.8*a):"column"===t&&r.fillText(""+(this.hints.column[e][n]||0),a*(e+.5),2*s/3+a*n,.8*a)}}]),t}();e.a=c},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),a=n(0),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=function(t){function e(t,n,o){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=s.theme,h=void 0===c?{}:c,l=s.grid,u=void 0===l?[]:l,f=s.threshold,d=void 0===f?.5:f,v=s.onHintChange,g=void 0===v?function(){}:v;r(this,e);var m=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));m.mousedown=function(t){var e=m.canvas.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top,i=2*e.width/3/(m.n+1),o=m.getLocation(n,r);if("controller"===o)m.refresh();else if("grid"===o){m.draw.firstI=Math.floor(r/i-.5),m.draw.firstJ=Math.floor(n/i-.5);var s=m.grid[m.draw.firstI][m.draw.firstJ];m.draw.brush=1===s?0:1,m.isPressed=!0,m.paintCell(m.draw.firstI,m.draw.firstJ),m.draw.lastI=m.draw.firstI,m.draw.lastJ=m.draw.firstJ}},m.mousemove=function(t){if(m.isPressed){var e=m.canvas.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top,i=2*e.width/3/(m.n+1);if("grid"===m.getLocation(n,r)){var o=Math.floor(r/i-.5),s=Math.floor(n/i-.5);o===m.draw.lastI&&s===m.draw.lastJ||(void 0===m.draw.direction&&(o===m.draw.firstI?m.draw.direction="row":s===m.draw.firstJ&&(m.draw.direction="column")),("row"===m.draw.direction&&o===m.draw.firstI||"column"===m.draw.direction&&s===m.draw.firstJ)&&(m.paintCell(o,s),m.draw.lastI=o,m.draw.lastJ=s))}}},m.brushUp=function(){delete m.isPressed,m.draw={}},m.theme.filledColor=a.a.violet,m.theme.correctColor=a.a.violet,Object.assign(m.theme,h),m.threshold=d,m.handleHintChange=g,m.m=t,m.n=n,m.grid=new Array(m.m);for(var w=0;w<m.m;w+=1){m.grid[w]=new Array(m.n);for(var p=0;p<m.n;p+=1)u.length?m.grid[w][p]=u[w][p]?1:0:m.grid[w][p]=Math.random()<m.threshold?1:0}m.hints={row:new Array(t),column:new Array(n)};for(var y=0;y<m.m;y+=1)m.hints.row[y]=m.calculateHints("row",y),m.hints.row[y].isCorrect=!0;for(var b=0;b<m.n;b+=1)m.hints.column[b]=m.calculateHints("column",b),m.hints.column[b].isCorrect=!0;return m.initCanvas(o),m.draw={},m.print(),m.handleHintChange(m.hints.row,m.hints.column),m}return o(e,t),c(e,[{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}},{key:"paintCell",value:function(t,e){this.grid[t][e]=this.draw.brush,this.hints.row[t]=this.calculateHints("row",t),this.hints.row[t].isCorrect=!0,this.hints.column[e]=this.calculateHints("column",e),this.hints.column[e].isCorrect=!0,this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"refresh",value:function(){for(var t=0;t<this.m;t+=1)for(var e=0;e<this.n;e+=1)this.grid[t][e]=Math.random()<this.threshold?1:0;for(var n=0;n<this.m;n+=1)this.hints.row[n]=this.calculateHints("row",n),this.hints.row[n].isCorrect=!0;for(var r=0;r<this.n;r+=1)this.hints.column[r]=this.calculateHints("column",r),this.hints.column[r].isCorrect=!0;this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=o/10;t.width=o,t.height=o;var n=t.getContext("2d")||new CanvasRenderingContext2D;return n.translate(o/2,o/2),n.arc(0,0,o/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=s,n.stroke(),n.beginPath(),n.moveTo((o/2+e)*Math.SQRT1_2,(o/2+e)*Math.SQRT1_2),n.lineTo((o/2-2*e)*Math.SQRT1_2,(o/2-2*e)*Math.SQRT1_2),n.lineTo((o/2-2*e)*Math.SQRT1_2,(o/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=s,n.fill(),t}var e=this.ctx,n=this.canvas,r=n.width,i=n.height,o=Math.min(r,i)/4,s=this.theme.filledColor;e.clearRect(2*r/3-1,2*i/3-1,r/3+1,i/3+1),e.save(),e.translate(.7*r,.7*i),e.drawImage(t(),0,0),e.restore()}}]),e}(s.a);e.a=h},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),a=n(0),c=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=function(t){function e(t,n,o){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=s.theme,h=void 0===c?{}:c,l=s.onSuccess,u=void 0===l?function(){}:l,f=s.onAnimationEnd,d=void 0===f?function(){}:f;r(this,e);var v=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));v.mousedown=function(t){var e=v.canvas.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top,i=2*e.width/3/(v.n+1),o=v.getLocation(n,r);if("controller"===o)v.switchBrush();else if("grid"===o){v.draw.firstI=Math.floor(r/i-.5),v.draw.firstJ=Math.floor(n/i-.5),v.draw.inverted=2===t.button;var s=v.grid[v.draw.firstI][v.draw.firstJ],a=v.brush;v.draw.inverted&&(a=1===v.brush?0:1),2!==s&&a!==s||(v.draw.mode=a===s?"empty":"filling",v.isPressed=!0,v.switchCell(v.draw.firstI,v.draw.firstJ)),v.draw.lastI=v.draw.firstI,v.draw.lastJ=v.draw.firstJ}},v.mousemove=function(t){if(v.isPressed){var e=v.canvas.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top,i=2*e.width/3/(v.n+1);if("grid"===v.getLocation(n,r)){var o=Math.floor(r/i-.5),s=Math.floor(n/i-.5);o===v.draw.lastI&&s===v.draw.lastJ||(void 0===v.draw.direction&&(o===v.draw.firstI?v.draw.direction="row":s===v.draw.firstJ&&(v.draw.direction="column")),("row"===v.draw.direction&&o===v.draw.firstI||"column"===v.draw.direction&&s===v.draw.firstJ)&&(v.switchCell(o,s),v.draw.lastI=o,v.draw.lastJ=s))}}},v.brushUp=function(){delete v.isPressed,v.draw={}},v.theme.filledColor=a.a.blue,v.theme.wrongColor=a.a.grey,v.theme.isMeshed=!0,Object.assign(v.theme,h),v.handleSuccess=u,v.handleAnimationEnd=d,v.hints={row:t.slice(),column:n.slice()},v.removeNonPositiveHints(),v.m=v.hints.row.length,v.n=v.hints.column.length,v.grid=new Array(v.m);for(var g=0;g<v.m;g+=1)v.grid[g]=new Array(v.n).fill(2);return v.hints.row.forEach(function(t,e){t.isCorrect=v.isLineCorrect("row",e)}),v.hints.column.forEach(function(t,e){t.isCorrect=v.isLineCorrect("column",e)}),v.initCanvas(o),v.brush=1,v.draw={},v.print(),v}return o(e,t),h(e,[{key:"calculateHints",value:function(t,e){var n=[];return this.getSingleLine(t,e).reduce(function(t,e){return 1===e&&n.push(t?n.pop()+1:1),1===e},!1),n}},{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}},{key:"switchBrush",value:function(){this.brush=0===this.brush?1:0,this.printController()}},{key:"switchCell",value:function(t,e){var n=this.brush;if(this.draw.inverted&&(n=1===this.brush?0:1),1===n&&0!==this.grid[t][e]){this.grid[t][e]="filling"===this.draw.mode?1:2,this.hints.row[t].isCorrect=this.isLineCorrect("row",t),this.hints.column[e].isCorrect=this.isLineCorrect("column",e),this.print();this.hints.row.every(function(t){return!!t.isCorrect})&&this.hints.column.every(function(t){return!!t.isCorrect})&&this.succeed()}else 0===n&&1!==this.grid[t][e]&&(this.grid[t][e]="filling"===this.draw.mode?0:2,this.print())}},{key:"printCell",value:function(t){var e=this.ctx,n=2*this.canvas.width/3/(this.n+1);switch(t){case 1:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-n,.05*-n,1.1*n,1.1*n);break;case 0:e.strokeStyle=a.a.red,e.lineWidth=n/15,e.beginPath(),e.moveTo(.3*n,.3*n),e.lineTo(.7*n,.7*n),e.moveTo(.3*n,.7*n),e.lineTo(.7*n,.3*n),e.stroke()}}},{key:"printController",value:function(){function t(){n.save(),n.translate(h,0),n.fillStyle=this.theme.meshColor,n.fillRect(0,0,c,c),n.fillStyle=this.theme.filledColor,n.fillRect(l,l,u,u),n.restore()}function e(){n.save(),n.translate(0,h),n.fillStyle=this.theme.meshColor,n.fillRect(0,0,c,c),n.clearRect(l,l,u,u),n.strokeStyle=a.a.red,n.lineWidth=l,n.beginPath(),n.moveTo(.3*c,.3*c),n.lineTo(.7*c,.7*c),n.moveTo(.3*c,.7*c),n.lineTo(.7*c,.3*c),n.stroke(),n.restore()}var n=this.ctx,r=this.canvas,i=r.width,o=r.height,s=Math.min(i,o)/4,c=3*s/4,h=s/4,l=s/20,u=c-2*l;n.clearRect(2*i/3-1,2*o/3-1,i/3+1,o/3+1),n.save(),n.translate(.7*i,.7*o),1===this.brush?(e.call(this),t.call(this)):0===this.brush&&(t.call(this),e.call(this)),n.restore()}},{key:"succeed",value:function(){function t(){var t=2*h,e=t/10,n=document.createElement("canvas");n.width=t,n.height=t;var r=n.getContext("2d")||new CanvasRenderingContext2D;return r.translate(t/3,5*t/6),r.rotate(-Math.PI/4),r.fillStyle=a.a.green,r.fillRect(0,0,e,-t*Math.SQRT2/3),r.fillRect(0,0,t*Math.SQRT2*2/3,-e),n}function e(t){return 1+Math.pow(t-1,3)}var n=this;this.handleSuccess(),this.listeners.forEach(function(t){var e=c(t,2),r=e[0],i=e[1];n.canvas.removeEventListener(r,i)});var r=this.ctx,i=this.canvas,o=i.width,s=i.height,h=Math.min(o,s)/4,l=r.getImageData(0,0,o,s),u=t(),f=0;!function t(){r.putImageData(l,0,0),f+=.03,r.globalAlpha=e(f),r.clearRect(2*o/3,2*s/3,o/3,s/3),r.drawImage(u,.7*o-(1-e(f))*h/2,.7*s-(1-e(f))*h/2,(2-e(f))*h,(2-e(f))*h),f<=1?requestAnimationFrame(t):n.handleAnimationEnd()}()}}]),e}(s.a);e.a=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),a=n(0),c=n(6),h=n.n(c),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t){function e(t,n,o){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=s.theme,l=void 0===c?{}:c,u=s.delay,f=void 0===u?50:u,d=s.onSuccess,v=void 0===d?function(){}:d,g=s.onError,m=void 0===g?function(){}:g;r(this,e);var w=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));w.worker=new h.a,w.click=function(t){if(!w.isBusy){var e=w.canvas.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top,i=2*e.width/3/(w.n+1),o=w.getLocation(n,r);if("grid"===o){if(w.isError)return;var s=Math.floor(r/i-.5),a=Math.floor(n/i-.5);2===w.grid[s][a]&&(w.grid[s][a]=1,w.hints.row[s].unchanged=!1,w.hints.column[a].unchanged=!1,w.solve())}else"controller"===o&&w.refresh()}},w.theme.filledColor=a.a.green,w.theme.correctColor=a.a.green,w.theme.wrongColor=a.a.yellow,Object.assign(w.theme,l),w.delay=f,w.handleSuccess=v,w.handleError=m,w.hints={row:t.slice(),column:n.slice()},w.removeNonPositiveHints(),w.m=w.hints.row.length,w.n=w.hints.column.length,w.grid=new Array(w.m);for(var p=0;p<w.m;p+=1)w.grid[p]=new Array(w.n).fill(2);return w.initCanvas(o),w.print(),w}return o(e,t),l(e,[{key:"initListeners",value:function(){this.listeners=[["click",this.click]]}},{key:"refresh",value:function(){this.grid=new Array(this.m);for(var t=0;t<this.m;t+=1)this.grid[t]=new Array(this.n).fill(2);this.hints.row.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),this.hints.column.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),this.solve()}},{key:"solve",value:function(){var t=this;this.isBusy||(this.print(),this.isBusy=!0,this.startTime=Date.now(),this.worker.onmessage=function(e){var n=e.data;if(t.canvas.nonogram!==t)return void t.worker.terminate();if(t.scanner=n.scanner,t.grid=n.grid,t.hints=n.hints,"update"!==n.type)if(t.isBusy=!1,"error"===n.type){t.isError=!0;var r=t.scanner,i=r.direction,o=r.i;t.handleError(new Error("Bad hints at "+i+" "+(o+1)))}else"finish"===n.type&&(t.isError=!1,t.handleSuccess(Date.now()-t.startTime));t.print()},this.worker.postMessage({delay:this.delay,grid:this.grid,hints:this.hints}))}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printScanner(),this.printController()}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=o/10;t.width=o,t.height=o;var n=t.getContext("2d")||new CanvasRenderingContext2D;return n.translate(o/2,o/2),n.rotate(Math.PI),n.arc(0,0,o/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=s,n.stroke(),n.beginPath(),n.moveTo((o/2+e)*Math.SQRT1_2,(o/2+e)*Math.SQRT1_2),n.lineTo((o/2-2*e)*Math.SQRT1_2,(o/2-2*e)*Math.SQRT1_2),n.lineTo((o/2-2*e)*Math.SQRT1_2,(o/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=s,n.fill(),t}var e=this.ctx,n=this.canvas,r=n.width,i=n.height,o=Math.min(r,i)/4,s=this.theme.filledColor;e.clearRect(2*r/3-1,2*i/3-1,r/3+1,i/3+1),this.isBusy||(e.save(),e.translate(.7*r,.7*i),e.drawImage(t(),0,0),e.restore())}},{key:"printScanner",value:function(){if(this.scanner){var t=this.ctx,e=this.canvas,n=e.width,r=e.height,i=2*n/3/(this.n+1);t.save(),t.translate(i/2,i/2),t.fillStyle=this.isError?this.theme.wrongColor:this.theme.correctColor,t.globalAlpha=.5,"row"===this.scanner.direction?t.fillRect(0,i*this.scanner.i,n,i):"column"===this.scanner.direction&&t.fillRect(i*this.scanner.i,0,i,r),t.restore()}}}]),e}(s.a);e.a=u},function(t,e){var n=window.URL||window.webkitURL;t.exports=function(t,e){try{try{var r;try{r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder),r.append(t),r=r.getBlob()}catch(e){r=new Blob([t])}return new Worker(n.createObjectURL(r))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(t){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}},function(t,e,n){t.exports=function(){return n(5)('!function(n){function e(i){if(r[i])return r[i].exports;var t=r[i]={i:i,l:!1,exports:{}};return n[i].call(t.exports,t,t.exports,e),t.l=!0,t.exports}var r={};e.m=n,e.c=r,e.i=function(n){return n},e.d=function(n,r,i){e.o(n,r)||Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(r,"a",r),r},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=0)}([function(n,e){function r(n){if(Array.isArray(n)){for(var e=0,r=Array(n.length);e<n.length;e++)r[e]=n[e];return r}return Array.from(n)}function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function t(n,e){return n.length===e.length&&n.every(function(n,r){return n===e[r]})}var s=function(){function n(n,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,r,i){return r&&n(e.prototype,r),i&&n(e,i),e}}(),c=function(n){return n.reduce(function(n,e){return n+e},0)},o=new Map;o.set(3,1),o.set(4,0),o.set(5,2);var u=function(){function n(e){var r=this;i(this,n),this.scan=function(){if(r.updateScanner()){r.delay&&(r.message={type:"update",grid:r.grid,scanner:r.scanner,hints:r.hints},postMessage(r.message)),r.isError=!0;var n=r.scanner,e=n.direction,i=n.i;r.currentHints=r.hints[e][i],r.currentHints.unchanged=!0,r.currentLine=r.getSingleLine(e,i);if(r.currentLine.every(function(n){return 2!==n})||(r.solveSingleLine(),r.setBackToGrid(r.currentLine)),r.isLineCorrect(e,i)&&(r.hints[e][i].isCorrect=!0,r.isError=!1),r.isError)return r.message={type:"error",grid:r.grid,scanner:r.scanner,hints:r.hints},void postMessage(r.message);r.delay?setTimeout(r.scan,r.delay):r.scan()}},this.hints=e.hints,this.delay=e.delay,this.grid=e.grid,this.scanner={direction:"row",i:-1},this.possibleBlanks={row:[],column:[]},this.scan()}return s(n,[{key:"getSingleLine",value:function(n,e){var r=[],i=this.grid.length,t=this.grid.length&&this.grid[0].length;if("row"===n)for(var s=0;s<t;s+=1)r[s]=this.grid[e][s];else if("column"===n)for(var c=0;c<i;c+=1)r[c]=this.grid[c][e];return r}},{key:"calculateHints",value:function(n,e){var r=[];return this.getSingleLine(n,e).reduce(function(n,e){if(1===e)r.push(n?r.pop()+1:1);else if(0!==e)throw new Error;return 1===e},!1),r}},{key:"isLineCorrect",value:function(n,e){try{return t(this.calculateHints(n,e),this.hints[n][e])}catch(n){return!1}}},{key:"updateScanner",value:function(){var n=void 0;do{if(this.isError=!1,this.scanner.i+=1,void 0===this.hints[this.scanner.direction][this.scanner.i]&&(this.scanner.direction="row"===this.scanner.direction?"column":"row",this.scanner.i=0),n=this.hints[this.scanner.direction][this.scanner.i],this.hints.row.every(function(n){return!!n.unchanged})&&this.hints.column.every(function(n){return!!n.unchanged}))return this.message={type:"finish",grid:this.grid,hints:this.hints},postMessage(this.message),!1}while(n.isCorrect||n.unchanged);return!0}},{key:"setBackToGrid",value:function(n){var e=this,r=this.scanner,i=r.direction,t=r.i;"row"===i?n.forEach(function(n,r){o.has(n)&&e.grid[t][r]!==o.get(n)&&(e.grid[t][r]=o.get(n),e.hints.column[r].unchanged=!1)}):"column"===i&&n.forEach(function(n,r){o.has(n)&&e.grid[r][t]!==o.get(n)&&(e.grid[r][t]=o.get(n),e.hints.row[r].unchanged=!1)})}},{key:"solveSingleLine",value:function(){this.isError=!0;var n=this.scanner,e=n.direction,r=n.i;void 0===this.possibleBlanks[e][r]&&(this.possibleBlanks[e][r]=[],this.findAll(this.currentLine.length-c(this.currentHints)+1)),this.merge()}},{key:"findAll",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r===this.currentHints.length){var i=e.slice(0,this.currentHints.length);i[0]-=1;var t=this.scanner,s=t.direction,c=t.i;this.possibleBlanks[s][c]&&this.possibleBlanks[s][c].push(i)}for(var o=1;o<=n;o+=1)e[r]=o,this.findAll(n-e[r],e,r+1)}},{key:"merge",value:function(){var n=this,e=this.scanner,i=e.direction,t=e.i,s=this.possibleBlanks[i][t];s.forEach(function(e,i){for(var t=[],c=0;c<n.currentHints.length;c+=1)t.push.apply(t,r(new Array(e[c]).fill(4))),t.push.apply(t,r(new Array(n.currentHints[c]).fill(3)));if(t.push.apply(t,r(new Array(n.currentLine.length-t.length).fill(4))),t.some(function(e,r){return 4===e&&1===n.currentLine[r]||3===e&&0===n.currentLine[r]}))return void delete s[i];n.isError=!1,t.forEach(function(e,r){3===e?4===n.currentLine[r]?n.currentLine[r]=5:2===n.currentLine[r]&&(n.currentLine[r]=3):4===e&&(3===n.currentLine[r]?n.currentLine[r]=5:2===n.currentLine[r]&&(n.currentLine[r]=4))})}),this.possibleBlanks[i][t]=s.filter(function(n){return n})}}]),n}();onmessage=function(n){new u(n.data)}}]);',null)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),i=n(2),o=n(3);n.d(e,"Solver",function(){return r.a}),n.d(e,"Editor",function(){return i.a}),n.d(e,"Game",function(){return o.a})}])});